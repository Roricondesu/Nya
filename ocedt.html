<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OC è§’è‰²ç®¡ç†å™¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Fredoka+One&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        @import url("https://fontsapi.zeoseven.com/181/main/result.css");
        @font-face {
            font-family: "Source Han Sans CN";
            src: local("Source Han Sans CN"), local("SourceHanSansCN"), url("font/fzkt.ttf") format("truetype");
        }
        @font-face {
            font-family: "Alibaba PuHuiTi";
            src: local("Alibaba PuHuiTi"), local("AlibabaPuHuiTi"), url("font/HL.otf") format("opentype");
        }
        @font-face {
            font-family: "ZCOOL KuaiLe";
            src: local("ZCOOL KuaiLe"), local("ZCOOLKuaiLe"), url("font/shufa.ttf") format("truetype");
        }
    </style>
    <style>
        :root {
            --primary: #ff9eb7;
            --secondary: #a2e1f6;
            --accent: #ffd166;
            --dark: #4a4e69;
            --light: #f8f9fa;
            --success: #06d6a0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body, body * {
            font-family: "Source Han Sans CN", "Alibaba PuHuiTi", "ZCOOL KuaiLe", "æœªæ¥åœ†SC", sans-serif;
            font-weight: normal;
        }
        
        body {
            background-color: #fef6f9;
            color: var(--dark);
            overflow-x: hidden;
        }
        
        /* ä¸»å®¹å™¨ */
        .app-container {
            display: flex;
            min-height: 100vh;
            transition: all 0.3s ease;
        }
        
        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 250px;
            background-color: var(--primary);
            padding: 20px;
            box-shadow: 5px 0 15px rgba(0,0,0,0.1);
            transform: translateX(0);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 10;
            position: relative;
        }
        
        .sidebar.collapsed {
            transform: translateX(-90%);
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            animation: bounceIn 1s;
        }
        
        .logo {
            font-family: "æœªæ¥åœ†SC", sans-serif;
            font-size: 24px;
            color: white;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.1);
            font-weight: normal;
        }
        
        .toggle-sidebar {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .toggle-sidebar:hover {
            transform: rotate(90deg);
        }
        
        .oc-list {
            list-style: none;
            margin-bottom: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .oc-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .oc-list::-webkit-scrollbar-thumb {
            background-color: rgba(255,255,255,0.5);
            border-radius: 4px;
        }
        
        .oc-item {
            background-color: rgba(255,255,255,0.3);
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .oc-item:hover {
            background-color: rgba(255,255,255,0.5);
            transform: translateX(5px);
        }
        
        .oc-item.active {
            background-color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateX(10px);
        }
        
        .oc-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background-color: var(--accent);
            transform: scaleY(0);
            transform-origin: top;
            transition: transform 0.3s;
        }
        
        .oc-item.active::after {
            transform: scaleY(1);
        }
        
        .oc-name {
            font-weight: normal;
            margin-bottom: 5px;
            font-family: "æœªæ¥åœ†SC", sans-serif;
        }
        
        .oc-date {
            font-size: 12px;
            color: rgba(0,0,0,0.6);
        }
        
        .add-oc-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--accent);
            border: none;
            border-radius: 10px;
            font-family: "æœªæ¥åœ†SC", sans-serif;
            font-weight: normal;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        
        .add-oc-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 0 rgba(0,0,0,0.1);
        }
        
        .add-oc-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 0 rgba(0,0,0,0.1);
        }
        
        .sidebar-footer {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
        }
        
        .action-btns {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            font-family: "æœªæ¥åœ†SC", sans-serif;
            font-weight: normal;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 3px 0 rgba(0,0,0,0.1);
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            padding: 30px;
            background-color: var(--light);
            transition: all 0.3s;
            position: relative;
        }
        
        .oc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            animation: fadeIn 0.5s;
        }
        
        .oc-title {
            font-family: "æœªæ¥åœ†SC", sans-serif;
            font-size: 32px;
            color: var(--dark);
            text-shadow: 2px 2px 0 rgba(0,0,0,0.05);
            font-weight: normal;
        }
        
        .oc-actions {
            display: flex;
            gap: 15px;
        }
        
        .oc-action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            background-color: var(--secondary);
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s;
            font-family: "æœªæ¥åœ†SC", sans-serif;
            font-size: 16px;
            font-weight: normal;
            box-shadow: 0 3px 0 rgba(0,0,0,0.1);
        }
        
        .oc-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 0 rgba(0,0,0,0.1);
        }
        
        .oc-action-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 0 rgba(0,0,0,0.1);
        }
        
        .oc-action-btn.delete {
            background-color: #ff6b6b;
            color: white;
        }
        
        /* é€‰é¡¹å¡ */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--secondary);
            margin-bottom: 20px;
            animation: slideInDown 0.5s;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            position: relative;
            font-family: "æœªæ¥åœ†SC", sans-serif;
            font-size: 18px;
            font-weight: normal;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: var(--primary);
        }
        
        .tab.active {
            color: var(--primary);
            font-weight: bold;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 4px;
            background-color: var(--primary);
            border-radius: 2px 2px 0 0;
            animation: stretch 0.3s forwards;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ç¼–è¾‘å™¨åŒºåŸŸ */
        .editor-container {
            display: flex;
            gap: 20px;
            height: calc(100vh - 200px);
        }
        
        .file-explorer {
            width: 200px;
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            overflow-y: auto;
            transition: all 0.3s;
        }
        
        .file-explorer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .file-explorer-title {
            font-size: 18px;
            color: var(--dark);
        }
        
        .add-file-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--accent);
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .add-file-btn:hover {
            transform: rotate(90deg) scale(1.1);
        }
        
        .file-tree {
            list-style: none;
        }
        
        .file-item {
            padding: 8px 10px;
            border-radius: 8px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-item:hover {
            background-color: rgba(162, 225, 246, 0.3);
        }
        
        .file-item.active {
            background-color: var(--secondary);
            font-weight: bold;
        }
        
        .file-icon {
            width: 20px;
            height: 20px;
        }
        
        .editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .toolbar {
            display: flex;
            padding: 10px 15px;
            background-color: var(--light);
            border-bottom: 1px solid #eee;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .tool-group {
            display: flex;
            align-items: center;
            margin-right: 15px;
            padding-right: 15px;
            border-right: 1px solid #ddd;
        }
        
        .tool-btn {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tool-btn:hover {
            background-color: rgba(0,0,0,0.05);
        }
        
        .tool-btn.active {
            background-color: var(--secondary);
        }
        
        .font-selector {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin-right: 10px;
        }
        
        .color-picker {
            width: 30px;
            height: 30px;
            border: none;
            cursor: pointer;
            background: none;
            padding: 0;
        }
        
        .editor {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .editor:focus {
            outline: none;
        }
        
        /* æ—¶é—´è½´æ ·å¼ */
        .timeline-container {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .timeline {
            position: relative;
            padding-left: 50px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 20px;
            width: 4px;
            background-color: var(--primary);
            border-radius: 2px;
        }
        
        .timeline-event {
            position: relative;
            margin-bottom: 30px;
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        
        .timeline-event:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .timeline-event::before {
            content: '';
            position: absolute;
            left: -40px;
            top: 15px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--accent);
            border: 4px solid var(--primary);
        }
        
        .timeline-date {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .timeline-content {
            font-size: 14px;
        }
        
        .add-timeline-event {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .timeline-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .add-timeline-btn {
            padding: 10px 15px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .add-timeline-btn:hover {
            background-color: #ff7aa1;
        }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .chart-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .chart-type {
            padding: 8px 15px;
            background-color: var(--light);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .chart-type.active {
            background-color: var(--primary);
            color: white;
        }
        
        .chart-canvas {
            width: 100%;
            height: 300px;
            background-color: #f9f9f9;
            border-radius: 10px;
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideInUp 0.3s;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            transition: all 0.3s;
        }
        
        .close-modal:hover {
            color: var(--dark);
            transform: rotate(90deg);
        }
        
        .modal-title {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Patrick Hand', cursive;
        }
        
        .modal-btn.cancel {
            background-color: #eee;
        }
        
        .modal-btn.confirm {
            background-color: var(--primary);
            color: white;
        }
        
        .modal-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 3px 0 rgba(0,0,0,0.1);
        }
        
        /* æ–‡ä»¶ä¸Šä¼ æ ·å¼ */
        .file-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        
        .file-upload:hover {
            border-color: var(--primary);
            background-color: rgba(255, 158, 183, 0.05);
        }
        
        .file-upload-icon {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        /* åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideInDown {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes bounceIn {
            0% { 
                opacity: 0;
                transform: scale(0.8);
            }
            50% { 
                opacity: 1;
                transform: scale(1.1);
            }
            100% { 
                transform: scale(1);
            }
        }
        
        @keyframes stretch {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }
        
        /* æµ®åŠ¨å…ƒç´  */
        .floating-elements {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 5;
        }
        
        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .floating-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .floating-btn.secondary {
            background-color: var(--secondary);
        }
        
        .floating-btn.accent {
            background-color: var(--accent);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                transform: translateX(0);
                padding: 15px;
            }
            
            .sidebar.collapsed {
                transform: translateX(-100%);
            }
            
            .main-content {
                padding: 20px;
            }
            
            .editor-container {
                flex-direction: column;
                height: auto;
            }
            
            .file-explorer {
                width: 100%;
                margin-bottom: 20px;
            }
            
            .oc-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .oc-actions {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        /* ç‰¹æ®Šæ•ˆæœ */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            opacity: 0;
            z-index: 999;
            animation: confettiFall 5s linear forwards;
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .loader.active {
            display: flex;
            animation: fadeIn 0.3s;
        }
        
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--primary);
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        .loader-text {
            font-family: 'Patrick Hand', cursive;
            color: var(--dark);
            font-size: 18px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">OC ç®¡ç†å™¨</div>
                <button class="toggle-sidebar">â‰¡</button>
            </div>
            
            <button class="add-oc-btn" id="addOcBtn">+ æ–°å»º OC</button>
            
            <ul class="oc-list" id="ocList">
                <!-- OC åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
            </ul>
            
            <div class="sidebar-footer">
                <div class="action-btns">
                    <button class="action-btn" id="exportAllBtn">
                        <span>å¯¼å‡ºå…¨éƒ¨</span>
                    </button>
                    <button class="action-btn" id="importBtn">
                        <span>å¯¼å…¥</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="oc-header">
                <h1 class="oc-title" id="ocTitle">é€‰æ‹©æˆ–åˆ›å»º OC</h1>
                <div class="oc-actions">
                    <button class="oc-action-btn" id="saveOcBtn">ä¿å­˜</button>
                    <button class="oc-action-btn" id="exportOcBtn">å¯¼å‡º</button>
                    <button class="oc-action-btn delete" id="deleteOcBtn">åˆ é™¤</button>
                </div>
            </div>
            
            <!-- é€‰é¡¹å¡ -->
            <div class="tabs">
                <div class="tab active" data-tab="editor">ç¼–è¾‘å™¨</div>
                <div class="tab" data-tab="timeline">æ—¶é—´è½´</div>
                <div class="tab" data-tab="charts">å›¾è¡¨</div>
                <div class="tab" data-tab="files">æ–‡ä»¶</div>
            </div>
            
            <!-- ç¼–è¾‘å™¨å†…å®¹ -->
            <div class="tab-content active" id="editorTab">
                <div class="editor-container">
                    <div class="file-explorer">
                        <div class="file-explorer-header">
                            <h3 class="file-explorer-title">æ–‡ä»¶</h3>
                            <button class="add-file-btn" id="addFileBtn">+</button>
                        </div>
                        <ul class="file-tree" id="fileTree">
                            <!-- æ–‡ä»¶æ ‘å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
                        </ul>
                    </div>
                    
                    <div class="editor-area">
                        <div class="toolbar">
                            <div class="tool-group">
                                <select class="font-selector" id="fontSelector">
                                    <option value="'Comic Neue', cursive" style="font-family: 'Comic Neue', cursive;">Comic Neue</option>
                                    <option value="'Patrick Hand', cursive" style="font-family: 'Patrick Hand', cursive;">Patrick Hand</option>
                                    <option value="'Fredoka One', cursive" style="font-family: 'Fredoka One', cursive;">Fredoka One</option>
                                    <option value="'Source Han Sans CN', sans-serif" style="font-family: 'Source Han Sans CN', sans-serif;">æ€æºé»‘ä½“</option>
                                    <option value="'Alibaba PuHuiTi', sans-serif" style="font-family: 'Alibaba PuHuiTi', sans-serif;">é˜¿é‡Œå·´å·´æ™®æƒ ä½“</option>
                                    <option value="Arial, sans-serif" style="font-family: Arial, sans-serif;">Arial</option>
                                    <option value="'Times New Roman', serif" style="font-family: 'Times New Roman', serif;">Times New Roman</option>
                                    <option value="'æœªæ¥åœ†SC', sans-serif" style="font-family: 'æœªæ¥åœ†SC', sans-serif;">æœªæ¥åœ†SC</option>
                                    <option value="'Noto Sans JP', sans-serif" style="font-family: 'Noto Sans JP', sans-serif;">Noto Sans JP</option>
                                </select>
                            </div>
                            <div class="tool-group">
                                <button class="tool-btn" data-command="bold" title="åŠ ç²—"><b>B</b></button>
                                <button class="tool-btn" data-command="italic" title="æ–œä½“"><i>I</i></button>
                                <button class="tool-btn" data-command="underline" title="ä¸‹åˆ’çº¿"><u>U</u></button>
                            </div>
                            <div class="tool-group">
                                <button class="tool-btn" data-command="insertUnorderedList" title="æ— åºåˆ—è¡¨">â€¢</button>
                                <button class="tool-btn" data-command="insertOrderedList" title="æœ‰åºåˆ—è¡¨">1.</button>
                            </div>
                            <div class="tool-group">
                                <input type="color" class="color-picker" id="textColorPicker" value="#000000" title="æ–‡å­—é¢œè‰²">
                            </div>
                            <div class="tool-group">
                                <button class="tool-btn" data-command="undo" title="æ’¤é”€">â†©</button>
                                <button class="tool-btn" data-command="redo" title="é‡åš">â†ª</button>
                            </div>
                        </div>
                        
                        <div class="editor" id="editor" contenteditable="true">
                            <!-- ç¼–è¾‘å™¨å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ—¶é—´è½´å†…å®¹ -->
            <div class="tab-content" id="timelineTab">
                <div class="timeline-container">
                    <div class="timeline" id="timeline">
                        <!-- æ—¶é—´è½´å†…å®¹å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="add-timeline-event">
                    <input type="date" class="timeline-input" id="timelineDate">
                    <input type="text" class="timeline-input" id="timelineEvent" placeholder="äº‹ä»¶æè¿°">
                    <button class="add-timeline-btn" id="addTimelineBtn">æ·»åŠ </button>
                </div>
            </div>
            
            <!-- å›¾è¡¨å†…å®¹ -->
            <div class="tab-content" id="chartsTab">
                <div class="chart-container">
                    <div class="chart-options">
                        <button class="chart-type active" data-chart-type="bar">æŸ±çŠ¶å›¾</button>
                        <button class="chart-type" data-chart-type="pie">é¥¼å›¾</button>
                        <button class="chart-type" data-chart-type="line">æŠ˜çº¿å›¾</button>
                    </div>
                    <canvas class="chart-canvas" id="chartCanvas"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3>å›¾è¡¨æ•°æ®ç¼–è¾‘å™¨</h3>
                    <div id="chartDataEditor">
                        <!-- å›¾è¡¨æ•°æ®ç¼–è¾‘å™¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <button class="oc-action-btn" id="updateChartBtn" style="margin-top: 15px;">æ›´æ–°å›¾è¡¨</button>
                </div>
            </div>
            
            <!-- æ–‡ä»¶å†…å®¹ -->
            <div class="tab-content" id="filesTab">
                <div class="file-upload" id="fileUpload">
                    <div class="file-upload-icon">ğŸ“</div>
                    <div>æ‹–æ”¾æ–‡ä»¶åˆ°è¿™é‡Œæˆ–ç‚¹å‡»ä¸Šä¼ </div>
                    <input type="file" id="fileInput" style="display: none;" multiple>
                </div>
                
                <div id="uploadedFiles">
                    <!-- ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- æµ®åŠ¨æŒ‰é’® -->
    <div class="floating-elements">
        <button class="floating-btn secondary" id="quickSaveBtn" title="å¿«é€Ÿä¿å­˜">ğŸ’¾</button>
        <button class="floating-btn accent" id="themeToggleBtn" title="åˆ‡æ¢ä¸»é¢˜">ğŸ¨</button>
        <button class="floating-btn" id="helpBtn" title="å¸®åŠ©">â“</button>
    </div>
    
    <!-- æ¨¡æ€æ¡† - æ–°å»º OC -->
    <div class="modal" id="newOcModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 class="modal-title">åˆ›å»ºæ–° OC</h2>
            <div class="form-group">
                <label class="form-label" for="ocName">OC åç§°</label>
                <input type="text" class="form-input" id="ocName" placeholder="è¾“å…¥ OC åç§°">
            </div>
            <div class="form-group">
                <label class="form-label" for="ocDescription">æè¿°</label>
                <textarea class="form-input form-textarea" id="ocDescription" placeholder="è¾“å…¥ OC æè¿°"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label" for="ocColor">ä¸»é¢˜é¢œè‰²</label>
                <input type="color" class="form-input" id="ocColor" value="#ff9eb7">
            </div>
            <div class="modal-actions">
                <button class="modal-btn cancel">å–æ¶ˆ</button>
                <button class="modal-btn confirm" id="confirmNewOc">åˆ›å»º</button>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡æ€æ¡† - æ–°å»ºæ–‡ä»¶ -->
    <div class="modal" id="newFileModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 class="modal-title">æ–°å»ºæ–‡ä»¶</h2>
            <div class="form-group">
                <label class="form-label" for="fileName">æ–‡ä»¶åç§°</label>
                <input type="text" class="form-input" id="fileName" placeholder="è¾“å…¥æ–‡ä»¶åç§°">
            </div>
            <div class="form-group">
                <label class="form-label" for="fileType">æ–‡ä»¶ç±»å‹</label>
                <select class="form-input" id="fileType">
                    <option value="text">æ–‡æœ¬æ–‡ä»¶</option>
                    <option value="image">å›¾ç‰‡</option>
                    <option value="note">ç¬”è®°</option>
                    <option value="other">å…¶ä»–</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="modal-btn cancel">å–æ¶ˆ</button>
                <button class="modal-btn confirm" id="confirmNewFile">åˆ›å»º</button>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡æ€æ¡† - å¯¼å…¥ -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 class="modal-title">å¯¼å…¥ OC</h2>
            <div class="form-group">
                <label class="form-label" for="importFile">é€‰æ‹© OC æ–‡ä»¶ (.ocpkg)</label>
                <input type="file" class="form-input" id="importFile" accept=".ocpkg">
            </div>
            <div class="modal-actions">
                <button class="modal-btn cancel">å–æ¶ˆ</button>
                <button class="modal-btn confirm" id="confirmImport">å¯¼å…¥</button>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡æ€æ¡† - å¸®åŠ© -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 class="modal-title">OC ç®¡ç†å™¨å¸®åŠ©</h2>
            <div class="form-group">
                <h3>åŸºæœ¬æ“ä½œ</h3>
                <p>1. ç‚¹å‡»"æ–°å»º OC"æŒ‰é’®åˆ›å»ºæ–°çš„OCè§’è‰²</p>
                <p>2. åœ¨ä¾§è¾¹æ é€‰æ‹©OCè§’è‰²è¿›è¡Œç¼–è¾‘</p>
                <p>3. ä½¿ç”¨é¡¶éƒ¨çš„é€‰é¡¹å¡åˆ‡æ¢ä¸åŒåŠŸèƒ½åŒºåŸŸ</p>
                <p>4. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®ä¿å­˜æ‚¨çš„æ›´æ”¹</p>
                
                <h3>ç¼–è¾‘å™¨åŠŸèƒ½</h3>
                <p>- ä½¿ç”¨å·¥å…·æ æ ¼å¼åŒ–æ–‡æœ¬</p>
                <p>- åœ¨æ–‡ä»¶èµ„æºç®¡ç†å™¨ä¸­åˆ›å»ºå’Œç®¡ç†å¤šä¸ªæ–‡ä»¶</p>
                <p>- æ—¶é—´è½´åŠŸèƒ½å¯ä»¥è®°å½•OCçš„é‡è¦äº‹ä»¶</p>
                <p>- å›¾è¡¨åŠŸèƒ½å¯ä»¥å¯è§†åŒ–OCçš„æ•°æ®</p>
                <p>- æ–‡ä»¶åŠŸèƒ½å¯ä»¥ä¸Šä¼ å’Œç®¡ç†ç›¸å…³èµ„æº</p>
                
                <h3>å¯¼å…¥å¯¼å‡º</h3>
                <p>- å¯ä»¥å¯¼å‡ºå•ä¸ªOCæˆ–å…¨éƒ¨OC</p>
                <p>- å¯¼å…¥åŠŸèƒ½å¯ä»¥æ¢å¤ä¹‹å‰å¯¼å‡ºçš„OC</p>
            </div>
            <div class="modal-actions">
                <button class="modal-btn confirm" id="closeHelpModal">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- åŠ è½½åŠ¨ç”» -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
        <div class="loader-text">åŠ è½½ä¸­...</div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let ocs = [];
        let currentOcId = null;
        let currentFileId = null;
        let chart = null;
        
        // DOM å…ƒç´ 
        const elements = {
            // ä¾§è¾¹æ 
            sidebar: document.querySelector('.sidebar'),
            toggleSidebar: document.querySelector('.toggle-sidebar'),
            ocList: document.getElementById('ocList'),
            addOcBtn: document.getElementById('addOcBtn'),
            exportAllBtn: document.getElementById('exportAllBtn'),
            importBtn: document.getElementById('importBtn'),
            
            // ä¸»å†…å®¹åŒº
            ocTitle: document.getElementById('ocTitle'),
            saveOcBtn: document.getElementById('saveOcBtn'),
            exportOcBtn: document.getElementById('exportOcBtn'),
            deleteOcBtn: document.getElementById('deleteOcBtn'),
            
            // é€‰é¡¹å¡
            tabs: document.querySelectorAll('.tab'),
            tabContents: document.querySelectorAll('.tab-content'),
            
            // ç¼–è¾‘å™¨
            fileTree: document.getElementById('fileTree'),
            addFileBtn: document.getElementById('addFileBtn'),
            editor: document.getElementById('editor'),
            fontSelector: document.getElementById('fontSelector'),
            textColorPicker: document.getElementById('textColorPicker'),
            toolBtns: document.querySelectorAll('.tool-btn'),
            
            // æ—¶é—´è½´
            timeline: document.getElementById('timeline'),
            timelineDate: document.getElementById('timelineDate'),
            timelineEvent: document.getElementById('timelineEvent'),
            addTimelineBtn: document.getElementById('addTimelineBtn'),
            
            // å›¾è¡¨
            chartCanvas: document.getElementById('chartCanvas'),
            chartTypes: document.querySelectorAll('.chart-type'),
            chartDataEditor: document.getElementById('chartDataEditor'),
            updateChartBtn: document.getElementById('updateChartBtn'),
            
            // æ–‡ä»¶
            fileUpload: document.getElementById('fileUpload'),
            fileInput: document.getElementById('fileInput'),
            uploadedFiles: document.getElementById('uploadedFiles'),
            
            // æ¨¡æ€æ¡†
            modals: document.querySelectorAll('.modal'),
            newOcModal: document.getElementById('newOcModal'),
            newFileModal: document.getElementById('newFileModal'),
            importModal: document.getElementById('importModal'),
            helpModal: document.getElementById('helpModal'),
            confirmNewOc: document.getElementById('confirmNewOc'),
            confirmNewFile: document.getElementById('confirmNewFile'),
            confirmImport: document.getElementById('confirmImport'),
            closeHelpModal: document.getElementById('closeHelpModal'),
            
            // æµ®åŠ¨æŒ‰é’®
            quickSaveBtn: document.getElementById('quickSaveBtn'),
            themeToggleBtn: document.getElementById('themeToggleBtn'),
            helpBtn: document.getElementById('helpBtn'),
            
            // åŠ è½½åŠ¨ç”»
            loader: document.getElementById('loader')
        };
        
        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            loadOcs();
            setupEventListeners();
            updateCurrentDate();
            
            // æ£€æŸ¥æ˜¯å¦æœ‰OCï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºåˆ›å»ºæ¨¡æ€æ¡†
            if (ocs.length === 0) {
                setTimeout(() => {
                    showModal(elements.newOcModal);
                }, 500);
            } else {
                loadOc(ocs[0].id);
            }
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // ä¾§è¾¹æ åˆ‡æ¢
            elements.toggleSidebar.addEventListener('click', toggleSidebar);
            
            // æ–°å»ºOCæŒ‰é’®
            elements.addOcBtn.addEventListener('click', () => showModal(elements.newOcModal));
            
            // å¯¼å‡ºå¯¼å…¥æŒ‰é’®
            elements.exportAllBtn.addEventListener('click', exportAllOcs);
            elements.importBtn.addEventListener('click', () => showModal(elements.importModal));
            
            // OCæ“ä½œæŒ‰é’®
            elements.saveOcBtn.addEventListener('click', saveCurrentOc);
            elements.exportOcBtn.addEventListener('click', exportCurrentOc);
            elements.deleteOcBtn.addEventListener('click', deleteCurrentOc);
            
            // é€‰é¡¹å¡åˆ‡æ¢
            elements.tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // ç¼–è¾‘å™¨å·¥å…·æ 
            elements.toolBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const command = btn.getAttribute('data-command');
                    if (command === 'undo' || command === 'redo') {
                        document.execCommand(command, false, null);
                    } else {
                        document.execCommand(command, false, null);
                        btn.classList.toggle('active');
                    }
                });
            });
            
            // å­—ä½“é€‰æ‹©å™¨
            elements.fontSelector.addEventListener('change', () => {
                document.execCommand('styleWithCSS', false, true);
                document.execCommand('fontName', false, elements.fontSelector.value);
            });
            
            // é¢œè‰²é€‰æ‹©å™¨
            elements.textColorPicker.addEventListener('input', () => {
                document.execCommand('styleWithCSS', false, true);
                document.execCommand('foreColor', false, elements.textColorPicker.value);
            });
            
            // æ–°å»ºæ–‡ä»¶æŒ‰é’®
            elements.addFileBtn.addEventListener('click', () => showModal(elements.newFileModal));
            
            // æ—¶é—´è½´æ·»åŠ äº‹ä»¶
            elements.addTimelineBtn.addEventListener('click', addTimelineEvent);
            
            // å›¾è¡¨ç±»å‹åˆ‡æ¢
            elements.chartTypes.forEach(type => {
                type.addEventListener('click', () => {
                    elements.chartTypes.forEach(t => t.classList.remove('active'));
                    type.classList.add('active');
                    updateChart();
                });
            });
            
            // æ›´æ–°å›¾è¡¨æŒ‰é’®
            elements.updateChartBtn.addEventListener('click', updateChart);
            
            // æ–‡ä»¶ä¸Šä¼ 
            elements.fileUpload.addEventListener('click', () => elements.fileInput.click());
            elements.fileUpload.addEventListener('dragover', (e) => {
                e.preventDefault();
                elements.fileUpload.style.borderColor = 'var(--primary)';
                elements.fileUpload.style.backgroundColor = 'rgba(255, 158, 183, 0.1)';
            });
            elements.fileUpload.addEventListener('dragleave', () => {
                elements.fileUpload.style.borderColor = '#ddd';
                elements.fileUpload.style.backgroundColor = 'transparent';
            });
            elements.fileUpload.addEventListener('drop', (e) => {
                e.preventDefault();
                elements.fileUpload.style.borderColor = '#ddd';
                elements.fileUpload.style.backgroundColor = 'transparent';
                handleFileUpload(e.dataTransfer.files);
            });
            elements.fileInput.addEventListener('change', () => {
                if (elements.fileInput.files.length > 0) {
                    handleFileUpload(elements.fileInput.files);
                }
            });
            
            // æ¨¡æ€æ¡†å…³é—­æŒ‰é’®
            document.querySelectorAll('.close-modal, .modal-btn.cancel').forEach(btn => {
                btn.addEventListener('click', () => {
                    hideAllModals();
                });
            });
            
            // æ–°å»ºOCç¡®è®¤æŒ‰é’®
            elements.confirmNewOc.addEventListener('click', createNewOc);
            
            // æ–°å»ºæ–‡ä»¶ç¡®è®¤æŒ‰é’®
            elements.confirmNewFile.addEventListener('click', createNewFile);
            
            // å¯¼å…¥ç¡®è®¤æŒ‰é’®
            elements.confirmImport.addEventListener('click', importOc);
            
            // å¸®åŠ©æŒ‰é’®
            elements.helpBtn.addEventListener('click', () => showModal(elements.helpModal));
            elements.closeHelpModal.addEventListener('click', () => hideModal(elements.helpModal));
            
            // æµ®åŠ¨æŒ‰é’®
            elements.quickSaveBtn.addEventListener('click', saveCurrentOc);
            elements.themeToggleBtn.addEventListener('click', toggleTheme);
            
            // ç¼–è¾‘å™¨å†…å®¹å˜åŒ–æ—¶è‡ªåŠ¨ä¿å­˜
            elements.editor.addEventListener('input', debounce(() => {
                if (currentOcId && currentFileId) {
                    const oc = getOcById(currentOcId);
                    const file = oc.files.find(f => f.id === currentFileId);
                    if (file) {
                        file.content = elements.editor.innerHTML;
                        saveOcsToLocalStorage();
                    }
                }
            }, 1000));
        }
        
        // åˆ‡æ¢ä¾§è¾¹æ 
        function toggleSidebar() {
            elements.sidebar.classList.toggle('collapsed');
        }
        
        // åˆ‡æ¢é€‰é¡¹å¡
        function switchTab(tabId) {
            // æ›´æ–°æ´»åŠ¨é€‰é¡¹å¡
            elements.tabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // æ›´æ–°æ´»åŠ¨å†…å®¹
            elements.tabContents.forEach(content => {
                if (content.id === `${tabId}Tab`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
            
            // å¦‚æœæ˜¯å›¾è¡¨é€‰é¡¹å¡ï¼Œåˆå§‹åŒ–å›¾è¡¨
            if (tabId === 'charts') {
                initChart();
            }
        }
        
        // åŠ è½½æ‰€æœ‰OC
        function loadOcs() {
            const savedOcs = localStorage.getItem('ocs');
            if (savedOcs) {
                ocs = JSON.parse(savedOcs);
                renderOcList();
            }
        }
        
        // ä¿å­˜æ‰€æœ‰OCåˆ°æœ¬åœ°å­˜å‚¨
        function saveOcsToLocalStorage() {
            localStorage.setItem('ocs', JSON.stringify(ocs));
        }
        
        // æ¸²æŸ“OCåˆ—è¡¨
        function renderOcList() {
            elements.ocList.innerHTML = '';
            
            ocs.forEach(oc => {
                const li = document.createElement('li');
                li.className = 'oc-item';
                if (oc.id === currentOcId) {
                    li.classList.add('active');
                }
                li.setAttribute('data-oc-id', oc.id);
                
                li.innerHTML = `
                    <div class="oc-name">${oc.name}</div>
                    <div class="oc-date">åˆ›å»ºäº: ${formatDate(oc.createdAt)}</div>
                `;
                
                li.addEventListener('click', () => loadOc(oc.id));
                elements.ocList.appendChild(li);
            });
        }
        
        // åŠ è½½ç‰¹å®šOC
        function loadOc(ocId) {
            const oc = getOcById(ocId);
            if (!oc) return;
            
            currentOcId = ocId;
            elements.ocTitle.textContent = oc.name;
            
            // æ›´æ–°æ´»åŠ¨OCæ ·å¼
            document.querySelectorAll('.oc-item').forEach(item => {
                if (item.getAttribute('data-oc-id') === ocId) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // æ¸²æŸ“æ–‡ä»¶æ ‘
            renderFileTree(oc.files);
            
            // åŠ è½½ç¬¬ä¸€ä¸ªæ–‡ä»¶å†…å®¹
            if (oc.files.length > 0) {
                loadFile(oc.files[0].id);
            } else {
                elements.editor.innerHTML = '';
                currentFileId = null;
            }
            
            // æ¸²æŸ“æ—¶é—´è½´
            renderTimeline(oc.timeline);
            
            // åˆå§‹åŒ–å›¾è¡¨æ•°æ®
            initChartDataEditor(oc.chartData || getDefaultChartData());
        }
        
        // è·å–ç‰¹å®šOC
        function getOcById(ocId) {
            return ocs.find(oc => oc.id === ocId);
        }
        
        // æ¸²æŸ“æ–‡ä»¶æ ‘
        function renderFileTree(files) {
            elements.fileTree.innerHTML = '';
            
            files.forEach(file => {
                const li = document.createElement('li');
                li.className = 'file-item';
                if (file.id === currentFileId) {
                    li.classList.add('active');
                }
                li.setAttribute('data-file-id', file.id);
                
                // æ ¹æ®æ–‡ä»¶ç±»å‹è®¾ç½®å›¾æ ‡
                let icon = 'ğŸ“„';
                if (file.type === 'image') icon = 'ğŸ–¼ï¸';
                if (file.type === 'note') icon = 'ğŸ“';
                
                li.innerHTML = `
                    <span class="file-icon">${icon}</span>
                    <span>${file.name}</span>
                `;
                
                li.addEventListener('click', () => loadFile(file.id));
                elements.fileTree.appendChild(li);
            });
        }
        
        // åŠ è½½æ–‡ä»¶å†…å®¹
        function loadFile(fileId) {
            if (!currentOcId) return;
            
            const oc = getOcById(currentOcId);
            if (!oc) return;
            
            const file = oc.files.find(f => f.id === fileId);
            if (!file) return;
            
            currentFileId = fileId;
            
            // æ›´æ–°æ´»åŠ¨æ–‡ä»¶æ ·å¼
            document.querySelectorAll('.file-item').forEach(item => {
                if (item.getAttribute('data-file-id') === fileId) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // åŠ è½½æ–‡ä»¶å†…å®¹åˆ°ç¼–è¾‘å™¨
            if (file.type === 'text' || file.type === 'note') {
                elements.editor.innerHTML = file.content || '';
                elements.editor.contentEditable = 'true';
            } else if (file.type === 'image') {
                elements.editor.innerHTML = `<img src="${file.content}" style="max-width: 100%;">`;
                elements.editor.contentEditable = 'false';
            } else {
                elements.editor.innerHTML = file.content || '';
                elements.editor.contentEditable = 'false';
            }
        }
        
        // æ¸²æŸ“æ—¶é—´è½´
        function renderTimeline(timeline) {
            elements.timeline.innerHTML = '';
            
            timeline.forEach(event => {
                const eventEl = document.createElement('div');
                eventEl.className = 'timeline-event';
                eventEl.innerHTML = `
                    <div class="timeline-date">${formatDate(event.date)}</div>
                    <div class="timeline-content">${event.text}</div>
                `;
                elements.timeline.appendChild(eventEl);
            });
        }
        
        // æ·»åŠ æ—¶é—´è½´äº‹ä»¶
        function addTimelineEvent() {
            if (!currentOcId) return;
            
            const date = elements.timelineDate.value;
            const text = elements.timelineEvent.value.trim();
            
            if (!date || !text) {
                alert('è¯·å¡«å†™æ—¥æœŸå’Œäº‹ä»¶æè¿°');
                return;
            }
            
            const oc = getOcById(currentOcId);
            if (!oc) return;
            
            oc.timeline.push({
                id: generateId(),
                date,
                text
            });
            
            // æŒ‰æ—¥æœŸæ’åº
            oc.timeline.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            saveOcsToLocalStorage();
            renderTimeline(oc.timeline);
            
            // æ¸…ç©ºè¾“å…¥
            elements.timelineEvent.value = '';
            updateCurrentDate();
            
            // æ˜¾ç¤ºåŠ¨ç”»æ•ˆæœ
            showConfetti();
        }
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            if (!currentOcId) return;
            
            const oc = getOcById(currentOcId);
            if (!oc) return;
            
            const ctx = elements.chartCanvas.getContext('2d');
            const chartType = document.querySelector('.chart-type.active').getAttribute('data-chart-type');
            
            if (chart) {
                chart.destroy();
            }
            
            chart = new Chart(ctx, {
                type: chartType,
                data: oc.chartData || getDefaultChartData(),
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'OC æ•°æ®å›¾è¡¨'
                        }
                    }
                }
            });
        }
        
        // è·å–é»˜è®¤å›¾è¡¨æ•°æ®
        function getDefaultChartData() {
            return {
                labels: ['åŠ›é‡', 'æ•æ·', 'æ™ºåŠ›', 'é­…åŠ›', 'å¹¸è¿'],
                datasets: [{
                    label: 'å±æ€§å€¼',
                    data: [5, 5, 5, 5, 5],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.7)',
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 206, 86, 0.7)',
                        'rgba(75, 192, 192, 0.7)',
                        'rgba(153, 102, 255, 0.7)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    borderWidth: 1
                }]
            };
        }
        
        // åˆå§‹åŒ–å›¾è¡¨æ•°æ®ç¼–è¾‘å™¨
        function initChartDataEditor(chartData) {
            elements.chartDataEditor.innerHTML = '';
            
            // åˆ›å»ºæ ‡ç­¾ç¼–è¾‘å™¨
            const labelsGroup = document.createElement('div');
            labelsGroup.className = 'form-group';
            labelsGroup.innerHTML = '<h3>æ ‡ç­¾</h3>';
            
            const labelsContainer = document.createElement('div');
            labelsContainer.style.display = 'flex';
            labelsContainer.style.flexWrap = 'wrap';
            labelsContainer.style.gap = '10px';
            labelsContainer.style.marginBottom = '15px';
            
            chartData.labels.forEach((label, index) => {
                const input = document.createElement('input');
                input.type = 'text';
                input.value = label;
                input.className = 'form-input';
                input.style.flex = '1';
                input.style.minWidth = '100px';
                input.addEventListener('input', () => {
                    chartData.labels[index] = input.value;
                });
                
                labelsContainer.appendChild(input);
            });
            
            // æ·»åŠ æ–°æ ‡ç­¾æŒ‰é’®
            const addLabelBtn = document.createElement('button');
            addLabelBtn.className = 'oc-action-btn';
            addLabelBtn.textContent = '+ æ·»åŠ æ ‡ç­¾';
            addLabelBtn.style.marginBottom = '15px';
            addLabelBtn.addEventListener('click', () => {
                chartData.labels.push(`å±æ€§ ${chartData.labels.length + 1}`);
                chartData.datasets[0].data.push(5);
                initChartDataEditor(chartData);
            });
            
            labelsGroup.appendChild(labelsContainer);
            labelsGroup.appendChild(addLabelBtn);
            elements.chartDataEditor.appendChild(labelsGroup);
            
            // åˆ›å»ºæ•°æ®ç¼–è¾‘å™¨
            const dataGroup = document.createElement('div');
            dataGroup.className = 'form-group';
            dataGroup.innerHTML = '<h3>æ•°æ®å€¼</h3>';
            
            const dataContainer = document.createElement('div');
            dataContainer.style.display = 'flex';
            dataContainer.style.flexWrap = 'wrap';
            dataContainer.style.gap = '10px';
            
            chartData.datasets[0].data.forEach((value, index) => {
                const inputGroup = document.createElement('div');
                inputGroup.style.display = 'flex';
                inputGroup.style.flexDirection = 'column';
                inputGroup.style.minWidth = '100px';
                
                const label = document.createElement('label');
                label.textContent = chartData.labels[index] || `æ•°æ® ${index + 1}`;
                label.style.marginBottom = '5px';
                label.style.fontSize = '14px';
                
                const input = document.createElement('input');
                input.type = 'number';
                input.min = '0';
                input.max = '10';
                input.value = value;
                input.className = 'form-input';
                input.addEventListener('input', () => {
                    chartData.datasets[0].data[index] = parseInt(input.value) || 0;
                });
                
                inputGroup.appendChild(label);
                inputGroup.appendChild(input);
                dataContainer.appendChild(inputGroup);
            });
            
            dataGroup.appendChild(dataContainer);
            elements.chartDataEditor.appendChild(dataGroup);
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateChart() {
            if (!currentOcId) return;
            
            const oc = getOcById(currentOcId);
            if (!oc) return;
            
            const chartType = document.querySelector('.chart-type.active').getAttribute('data-chart-type');
            
            if (chart) {
                chart.destroy();
            }
            
            const ctx = elements.chartCanvas.getContext('2d');
            chart = new Chart(ctx, {
                type: chartType,
                data: oc.chartData || getDefaultChartData(),
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'OC æ•°æ®å›¾è¡¨'
                        }
                    }
                }
            });
            
            // ä¿å­˜å›¾è¡¨æ•°æ®
            oc.chartData = chart.data;
            saveOcsToLocalStorage();
        }
        
        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(files) {
            if (!currentOcId) return;
            
            const oc = getOcById(currentOcId);
            if (!oc) return;
            
            showLoader();
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const fileType = file.type.startsWith('image/') ? 'image' : 'other';
                    
                    oc.files.push({
                        id: generateId(),
                        name: file.name,
                        type: fileType,
                        content: e.target.result
                    });
                    
                    saveOcsToLocalStorage();
                    renderFileTree(oc.files);
                    hideLoader();
                };
                
                if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file);
                } else {
                    reader.readAsText(file);
                }
            });
            
            elements.fileInput.value = '';
        }
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showModal(modal) {
            hideAllModals();
            modal.classList.add('active');
        }
        
        // éšè—æ¨¡æ€æ¡†
        function hideModal(modal) {
            modal.classList.remove('active');
        }
        
        // éšè—æ‰€æœ‰æ¨¡æ€æ¡†
        function hideAllModals() {
            elements.modals.forEach(modal => {
                modal.classList.remove('active');
            });
        }
        
        // åˆ›å»ºæ–°OC
        function createNewOc() {
            const name = document.getElementById('ocName').value.trim();
            const description = document.getElementById('ocDescription').value.trim();
            const color = document.getElementById('ocColor').value;
            
            if (!name) {
                alert('è¯·å¡«å†™OCåç§°');
                return;
            }
            
            const newOc = {
                id: generateId(),
                name,
                description,
                color,
                createdAt: new Date().toISOString(),
                files: [],
                timeline: [],
                chartData: getDefaultChartData()
            };
            
            // æ·»åŠ é»˜è®¤æ–‡ä»¶
            newOc.files.push({
                id: generateId(),
                name: 'ä¸»æ–‡æ¡£',
                type: 'text',
                content: `<h1>${name}</h1><p>${description || 'æš‚æ— æè¿°'}</p>`
            });
            
            ocs.push(newOc);
            saveOcsToLocalStorage();
            renderOcList();
            loadOc(newOc.id);
            
            // é‡ç½®è¡¨å•
            document.getElementById('ocName').value = '';
            document.getElementById('ocDescription').value = '';
            
            hideModal(elements.newOcModal);
            
            // æ˜¾ç¤ºåº†ç¥æ•ˆæœ
            showConfetti();
        }
        
        // åˆ›å»ºæ–°æ–‡ä»¶
        function createNewFile() {
            if (!currentOcId) return;
            
            const name = document.getElementById('fileName').value.trim();
            const type = document.getElementById('fileType').value;
            
            if (!name) {
                alert('è¯·å¡«å†™æ–‡ä»¶åç§°');
                return;
            }
            
            const oc = getOcById(currentOcId);
            if (!oc) return;
            
            let content = '';
            if (type === 'text') content = `<h2>${name}</h2><p>å¼€å§‹ç¼–è¾‘ä½ çš„æ–‡æ¡£...</p>`;
            if (type === 'note') content = `<h2>${name}</h2><p>è®°å½•ä½ çš„ç¬”è®°...</p>`;
            
            oc.files.push({
                id: generateId(),
                name,
                type,
                content
            });
            
            saveOcsToLocalStorage();
            renderFileTree(oc.files);
            loadFile(oc.files[oc.files.length - 1].id);
            
            // é‡ç½®è¡¨å•
            document.getElementById('fileName').value = '';
            
            hideModal(elements.newFileModal);
        }
        
        // ä¿å­˜å½“å‰OC
        function saveCurrentOc() {
            if (!currentOcId || !currentFileId) return;
            
            const oc = getOcById(currentOcId);
            const file = oc.files.find(f => f.id === currentFileId);
            
            if (file && (file.type === 'text' || file.type === 'note')) {
                file.content = elements.editor.innerHTML;
            }
            
            saveOcsToLocalStorage();
            
            // æ˜¾ç¤ºä¿å­˜æˆåŠŸåŠ¨ç”»
            const saveBtn = elements.quickSaveBtn;
            saveBtn.textContent = 'âœ“';
            saveBtn.style.backgroundColor = 'var(--success)';
            
            setTimeout(() => {
                saveBtn.textContent = 'ğŸ’¾';
                saveBtn.style.backgroundColor = 'var(--secondary)';
            }, 1000);
        }
        
        // å¯¼å‡ºå½“å‰OC
        function exportCurrentOc() {
            if (!currentOcId) return;
            
            const oc = getOcById(currentOcId);
            if (!oc) return;
            
            showLoader();
            
            // åˆ›å»ºä¸€ä¸ªzipæ–‡ä»¶
            const zip = new JSZip();
            
            // æ·»åŠ OCåŸºæœ¬ä¿¡æ¯
            zip.file('oc-info.json', JSON.stringify({
                name: oc.name,
                description: oc.description,
                createdAt: oc.createdAt
            }));
            
            // æ·»åŠ æ–‡ä»¶
            const filesFolder = zip.folder('files');
            oc.files.forEach(file => {
                if (file.type === 'image') {
                    // å¯¹äºå›¾ç‰‡ï¼Œéœ€è¦å°†base64è½¬æ¢ä¸ºblob
                    const base64Data = file.content.split(',')[1];
                    const blob = b64toBlob(base64Data, file.content.match(/^data:(.*);base64,/)[1]);
                    filesFolder.file(file.name, blob);
                } else {
                    filesFolder.file(`${file.name}.${file.type}`, file.content);
                }
            });
            
            // æ·»åŠ æ—¶é—´è½´
            zip.file('timeline.json', JSON.stringify(oc.timeline));
            
            // æ·»åŠ å›¾è¡¨æ•°æ®
            zip.file('chart-data.json', JSON.stringify(oc.chartData));
            
            // ç”Ÿæˆzipæ–‡ä»¶
            zip.generateAsync({ type: 'blob' }).then(content => {
                saveAs(content, `${oc.name}.ocpkg`);
                hideLoader();
            });
        }
        
        // å¯¼å‡ºæ‰€æœ‰OC
        function exportAllOcs() {
            if (ocs.length === 0) return;
            
            showLoader();
            
            const zip = new JSZip();
            
            ocs.forEach(oc => {
                const ocFolder = zip.folder(oc.name);
                
                // æ·»åŠ OCåŸºæœ¬ä¿¡æ¯
                ocFolder.file('oc-info.json', JSON.stringify({
                    name: oc.name,
                    description: oc.description,
                    createdAt: oc.createdAt
                }));
                
                // æ·»åŠ æ–‡ä»¶
                const filesFolder = ocFolder.folder('files');
                oc.files.forEach(file => {
                    if (file.type === 'image') {
                        const base64Data = file.content.split(',')[1];
                        const blob = b64toBlob(base64Data, file.content.match(/^data:(.*);base64,/)[1]);
                        filesFolder.file(file.name, blob);
                    } else {
                        filesFolder.file(`${file.name}.${file.type}`, file.content);
                    }
                });
                
                // æ·»åŠ æ—¶é—´è½´
                ocFolder.file('timeline.json', JSON.stringify(oc.timeline));
                
                // æ·»åŠ å›¾è¡¨æ•°æ®
                ocFolder.file('chart-data.json', JSON.stringify(oc.chartData));
            });
            
            zip.generateAsync({ type: 'blob' }).then(content => {
                saveAs(content, `æ‰€æœ‰OCå¤‡ä»½_${formatDate(new Date())}.ocpkg`);
                hideLoader();
            });
        }
        
        // å¯¼å…¥OC
        function importOc() {
            const fileInput = document.getElementById('importFile');
            if (!fileInput.files.length) {
                alert('è¯·é€‰æ‹©è¦å¯¼å…¥çš„æ–‡ä»¶');
                return;
            }
            
            const file = fileInput.files[0];
            if (!file.name.endsWith('.ocpkg')) {
                alert('è¯·é€‰æ‹©.ocpkgæ–‡ä»¶');
                return;
            }
            
            showLoader();
            
            const reader = new FileReader();
            reader.onload = function(e) {
                JSZip.loadAsync(e.target.result).then(zip => {
                    // è¯»å–OCåŸºæœ¬ä¿¡æ¯
                    return zip.file('oc-info.json').async('text').then(infoStr => {
                        const info = JSON.parse(infoStr);
                        const newOc = {
                            id: generateId(),
                            name: info.name,
                            description: info.description,
                            createdAt: info.createdAt || new Date().toISOString(),
                            files: [],
                            timeline: [],
                            chartData: getDefaultChartData()
                        };
                        
                        // è¯»å–æ–‡ä»¶
                        const filesFolder = zip.folder('files');
                        if (filesFolder) {
                            return Promise.all(
                                Object.keys(filesFolder.files).map(filename => {
                                    if (!filesFolder.files[filename].dir) {
                                        return filesFolder.file(filename).async('base64').then(content => {
                                            let fileType = 'text';
                                            if (filename.match(/\.(png|jpg|jpeg|gif|bmp)$/i)) {
                                                fileType = 'image';
                                                content = `data:image/${filename.split('.').pop()};base64,${content}`;
                                            }
                                            
                                            newOc.files.push({
                                                id: generateId(),
                                                name: filename.split('.')[0],
                                                type: fileType,
                                                content: fileType === 'image' ? content : atob(content)
                                            });
                                        });
                                    }
                                })
                            ).then(() => {
                                // è¯»å–æ—¶é—´è½´
                                const timelineFile = zip.file('timeline.json');
                                if (timelineFile) {
                                    return timelineFile.async('text').then(timelineStr => {
                                        newOc.timeline = JSON.parse(timelineStr);
                                        return newOc;
                                    });
                                }
                                return newOc;
                            }).then(newOc => {
                                // è¯»å–å›¾è¡¨æ•°æ®
                                const chartDataFile = zip.file('chart-data.json');
                                if (chartDataFile) {
                                    return chartDataFile.async('text').then(chartDataStr => {
                                        newOc.chartData = JSON.parse(chartDataStr);
                                        return newOc;
                                    });
                                }
                                return newOc;
                            });
                        }
                        return newOc;
                    });
                }).then(newOc => {
                    ocs.push(newOc);
                    saveOcsToLocalStorage();
                    renderOcList();
                    loadOc(newOc.id);
                    hideLoader();
                    hideModal(elements.importModal);
                    fileInput.value = '';
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    alert(`æˆåŠŸå¯¼å…¥OC: ${newOc.name}`);
                }).catch(error => {
                    console.error('å¯¼å…¥å¤±è´¥:', error);
                    hideLoader();
                    alert('å¯¼å…¥å¤±è´¥ï¼Œæ–‡ä»¶å¯èƒ½å·²æŸå');
                });
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // åˆ é™¤å½“å‰OC
        function deleteCurrentOc() {
            if (!currentOcId) return;
            
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªOCå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                return;
            }
            
            const index = ocs.findIndex(oc => oc.id === currentOcId);
            if (index !== -1) {
                ocs.splice(index, 1);
                saveOcsToLocalStorage();
                
                if (ocs.length > 0) {
                    loadOc(ocs[0].id);
                } else {
                    currentOcId = null;
                    elements.ocTitle.textContent = 'é€‰æ‹©æˆ–åˆ›å»º OC';
                    elements.fileTree.innerHTML = '';
                    elements.editor.innerHTML = '';
                    elements.timeline.innerHTML = '';
                }
                
                renderOcList();
            }
        }
        
        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤æ‚çš„ä¸»é¢˜åˆ‡æ¢é€»è¾‘
            const btn = elements.themeToggleBtn;
            btn.textContent = btn.textContent === 'ğŸŒ™' ? 'â˜€ï¸' : 'ğŸŒ™';
        }
        
        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        function showLoader() {
            elements.loader.classList.add('active');
        }
        
        // éšè—åŠ è½½åŠ¨ç”»
        function hideLoader() {
            elements.loader.classList.remove('active');
        }
        
        // æ˜¾ç¤ºå½©è‰²çº¸å±‘æ•ˆæœ
        function showConfetti() {
            for (let i = 0; i < 50; i++) {
                createConfetti();
            }
        }
        
        // åˆ›å»ºå•ä¸ªå½©è‰²çº¸å±‘
        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            
            // éšæœºé¢œè‰²
            const colors = ['#ff9eb7', '#a2e1f6', '#ffd166', '#06d6a0', '#ff6b6b'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.backgroundColor = randomColor;
            
            // éšæœºä½ç½®
            const startX = Math.random() * window.innerWidth;
            confetti.style.left = `${startX}px`;
            
            // éšæœºå¤§å°
            const size = Math.random() * 10 + 5;
            confetti.style.width = `${size}px`;
            confetti.style.height = `${size}px`;
            
            // éšæœºåŠ¨ç”»æŒç»­æ—¶é—´
            const duration = Math.random() * 3 + 2;
            confetti.style.animationDuration = `${duration}s`;
            
            document.body.appendChild(confetti);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤
            setTimeout(() => {
                confetti.remove();
            }, duration * 1000);
        }
        
        // æ›´æ–°å½“å‰æ—¥æœŸåˆ°æ—¶é—´è½´æ—¥æœŸè¾“å…¥
        function updateCurrentDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            elements.timelineDate.value = `${year}-${month}-${day}`;
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }
        
        // ç”Ÿæˆå”¯ä¸€ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function() {
                const context = this;
                const args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    func.apply(context, args);
                }, wait);
            };
        }
        
        // Base64è½¬Blob
        function b64toBlob(b64Data, contentType = '', sliceSize = 512) {
            const byteCharacters = atob(b64Data);
            const byteArrays = [];
            
            for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
                const slice = byteCharacters.slice(offset, offset + sliceSize);
                
                const byteNumbers = new Array(slice.length);
                for (let i = 0; i < slice.length; i++) {
                    byteNumbers[i] = slice.charCodeAt(i);
                }
                
                const byteArray = new Uint8Array(byteNumbers);
                byteArrays.push(byteArray);
            }
            
            return new Blob(byteArrays, { type: contentType });
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>